import{B as e,r as t,f as a,p as r,c as i,o as n,j as l,x as s,w as o,a as d,t as c,k as g,F as p,C as u,b as h,D as f,e as y,_ as v,z as m,E as x,y as b}from"./C0ajcZnf.js";import{G as k,I as S,F as N,H as I,a as w,b as $,c as C,d as _}from"./CyJ4Y1vI.js";const D=e("registryNav",(()=>{const e=t([]),a=t(!1),r=t(null),i=t(!1),n="/registry-navigation.json",l=e=>e.map((e=>({...e,slug:e.slug,icon:e.icon,expanded:!!e.isCategory,loadingChildren:!1,children:e.children?l(e.children):[]}))),s=async e=>{if(e)try{const t=`/api/registry-nav?parentId=${e}`;console.log(`[registryNavStore] Fetching children for page ID ${e} from navigation cache: ${t}`);const a=await $fetch(t);if(a&&a.length>0)return console.log(`[registryNavStore] Successfully fetched ${a.length} child items from MongoDB cache`),l(a);console.warn(`[registryNavStore] No children found for parent ID ${e} in MongoDB cache, falling back to direct API`);const r=`/api/payload/registry-pages?where[parent][equals]=${e}&where[status][equals]=published&sort=sort`;console.log(`[registryNavStore] Falling back to direct API: ${r}`);const i=await $fetch(r);if(!i||!i.docs)return[];const n=i.docs.map((e=>({id:e.id,title:e.title,slug:e.slug,icon:e.icon,hasChildren:!1})));return l(n)}catch(t){return console.error(`[registryNavStore] Error fetching children for page ${e}:`,t),[]}try{const e="/api/registry-nav";console.log(`[registryNavStore] Fetching from MongoDB cache API: ${e}`);const t=await $fetch(e);if(t&&t.length>0)return console.log(`[registryNavStore] Successfully fetched ${t.length} items from MongoDB cache`),l(t);console.warn("[registryNavStore] MongoDB cache returned empty navigation data")}catch(a){console.error("[registryNavStore] Failed to fetch from MongoDB cache:",a)}try{console.log(`[registryNavStore] Falling back to static file: ${n}`);const e=await $fetch(n);return l(e)}catch(r){return console.error("[registryNavStore] Static navigation file also failed:",r),[]}},o=(e,t)=>{for(const a of e){if(a.id===t)return a;if(a.children&&a.children.length>0){const e=o(a.children,t);if(e)return e}}return null};return{processedNavigationItems:e,pending:a,error:r,isInitialized:i,ensureInitialized:async()=>{if(!i.value&&!a.value){console.log("[registryNavStore] Initializing navigation store..."),a.value=!0,r.value=null;try{e.value=await s(null),i.value=!0,console.log("[registryNavStore] Navigation loaded successfully")}catch(t){console.error("Failed to fetch registry navigation:",t),r.value=t,e.value=[]}finally{a.value=!1}}},toggleExpand:async t=>{const a=o(e.value,t);if(a){if(a.expanded=!a.expanded,a.expanded&&a.hasChildren&&0===a.children.length&&!a.loadingChildren){a.loadingChildren=!0;try{a.children=await s(a.id)}catch(r){console.error(`[registryNavStore] Failed to fetch children for ${a.title}:`,r)}finally{a.loadingChildren=!1}}}else console.warn(`[registryNavStore] Item not found for toggleExpand: ${t}`)}}})),F={class:"registry-navigation bg-light-grey text-gray-800 p-4 rounded-md h-full"},z={class:"text-lg font-semibold"},B={key:1,class:"space-y-1"},L={class:"flex items-center justify-between group"},E={key:1,class:"mr-2 inline-block h-5 w-5 align-middle"},M={class:"align-middle text-sm [font-variant-ligatures:stylistic] [font-feature-settings:'ss01']"},P=["onClick","aria-expanded","aria-label"],T={key:0,class:"text-xs"},j={key:0,class:"ml-6 mt-1 pl-3 border-l border-primary-200 space-y-1"},O={key:1,class:"mr-2 inline-block h-4 w-4 align-middle"},R={class:"align-middle [font-variant-ligatures:stylistic] [font-feature-settings:'ss01']"},A={key:1,class:"ml-6 mt-1 pl-3 text-xs text-gray-500"},q={key:2},G={key:3,class:"text-gray-600"},H={key:4,class:"text-red-500"},Q=v(a({__name:"RegistryNavigation",props:{navTitle:{type:String,default:"Registry Menu"},currentParentId:{type:String,default:null}},setup(e){const t={FileText:k,BookOpen:_,Folder:C,Link:$,Info:w,Question:I,Gear:N,House:S,Default:k},a=e=>e&&t[e]||t.Default,v=D();return r((()=>{v.ensureInitialized()})),(t,r)=>{const m=y;return n(),i("div",F,[e.navTitle?(n(),l(m,{key:0,to:"/registry",class:"block text-brand-900 hover:bg-purple-light hover:text-primary-700 p-2 rounded-md transition-colors duration-150 -ml-2 -mr-2 mb-1"},{default:o((()=>[d("h3",z,c(e.navTitle),1)])),_:1})):s("",!0),g(v).processedNavigationItems&&g(v).processedNavigationItems.length>0?(n(),i("ul",B,[(n(!0),i(p,null,u(g(v).processedNavigationItems,(e=>(n(),i("li",{key:e.id},[d("div",L,[h(m,{to:`/registry/${e.slug}`,class:"flex-grow text-brand-900 hover:bg-purple-light hover:text-primary-700 p-2 rounded-md transition-colors duration-150","active-class":"bg-purple-light text-primary-700 font-semibold"},{default:o((()=>[e.icon?(n(),l(f(a(e.icon)),{key:0,class:"mr-2 inline-block h-5 w-5 align-middle","aria-hidden":"true"})):(n(),i("span",E)),d("span",M,c(e.title),1)])),_:2},1032,["to"]),e.hasChildren?(n(),i("button",{key:0,onClick:()=>g(v).toggleExpand(e.id),class:"p-1 ml-2 rounded-md text-brand-900 hover:bg-purple-light hover:text-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500","aria-expanded":e.expanded?"true":"false","aria-label":e.expanded?`Collapse ${e.title}`:`Expand ${e.title}`},[e.loadingChildren?(n(),i("span",T,"...")):s("",!0),d("span",null,c(e.expanded?"-":"+"),1)],8,P)):s("",!0)]),e.expanded&&e.children&&e.children.length>0?(n(),i("ul",j,[(n(!0),i(p,null,u(e.children,(e=>(n(),i("li",{key:e.id},[h(m,{to:`/registry/${e.slug}`,class:"flex items-center text-brand-900 hover:bg-purple-light hover:text-primary-700 p-2 rounded-md transition-colors duration-150 text-sm","active-class":"bg-purple-light text-primary-700 font-semibold"},{default:o((()=>[e.icon?(n(),l(f(a(e.icon)),{key:0,class:"mr-2 inline-block h-4 w-4 align-middle","aria-hidden":"true"})):(n(),i("span",O)),d("span",R,c(e.title),1)])),_:2},1032,["to"])])))),128))])):s("",!0),e.expanded&&e.children&&0===e.children.length&&!e.loadingChildren?(n(),i("p",A," No sub-pages. ")):s("",!0)])))),128))])):g(v).pending||g(v).processedNavigationItems&&0!==g(v).processedNavigationItems.length?s("",!0):(n(),i("p",q," No pages found in this section. ")),g(v).pending&&!g(v).isInitialized?(n(),i("p",G," Loading navigation... ")):s("",!0),g(v).error?(n(),i("p",H," Error loading navigation: "+c(g(v).error.message),1)):s("",!0)])}}}),[["__scopeId","data-v-16aea546"]]),U={class:"flex flex-col items-start lg:flex-row relative"},J={class:"flex-1 p-4 lg:p-8"},K={class:"relative"},V=v(a({__name:"RegistryLayout",props:{backgroundImageUrl:{type:String,default:void 0},backgroundOverlay:{type:String,default:"none"},navParentId:{type:String,default:null},navTitle:{type:String,default:"In this section"},isLeftSidebarOpen:{type:Boolean,default:!1}},emits:["closeLeftSidebar"],setup:(e,{emit:t})=>(t,a)=>{const r=Q,l=b;return n(),i("div",U,[d("aside",{class:m(["w-full fixed top-0 left-0 z-[11] pt-[5.5rem] overflow-scroll h-screen bg-light-grey lg:bg-none lg:h-auto lg:min-h-screen lg:translate-x-0 lg:w-[21.6rem] lg:pt-0 lg:pr-0 lg:sticky lg:top-[5.5rem] transition-all duration-700",{"translate-x-[-100%]":!e.isLeftSidebarOpen,"translate-x-[0]":e.isLeftSidebarOpen}])},[h(r,{"current-parent-id":e.navParentId,"nav-title":e.navTitle},null,8,["current-parent-id","nav-title"]),d("button",{onClick:a[0]||(a[0]=e=>t.$emit("closeLeftSidebar")),class:"absolute top-[6.5rem] right-3 z-[12] lg:hidden h-[30px] w-[30px]","aria-title":"Close wiki nav"},[h(l,{name:"ph:x",size:"24"})])],2),d("main",J,[d("div",K,[x(t.$slots,"default",{},void 0,!0)])])])}}),[["__scopeId","data-v-b8c07d62"]]);export{V as R};
