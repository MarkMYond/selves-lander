import{B as e,r as i,f as t,p as a,c as l,o as n,j as r,x as s,w as o,a as d,t as c,k as p,F as g,C as u,b as h,D as m,e as f,_ as y,z as x,E as v,y as k}from"./C0ajcZnf.js";import{G as b,I as w,F as C,H as $,a as N,b as I,c as S,d as _}from"./CyJ4Y1vI.js";const D=e("wikiNav",(()=>{const e=i([]),t=i(!1),a=i(null),l=i(!1),n=e=>e.map((e=>({...e,slug:e.slug,icon:e.icon,expanded:!!e.isCategory,loadingChildren:!1,children:e.children?n(e.children):[]}))),r=async e=>{if(e)try{const i=`/api/wiki-nav?parentId=${e}`;console.log(`[wikiNavStore] Fetching children for page ID ${e} from navigation cache: ${i}`);const t=await $fetch(i);if(t&&t.length>0)return console.log(`[wikiNavStore] Successfully fetched ${t.length} child items from MongoDB cache`),n(t);console.warn(`[wikiNavStore] No children found for parent ID ${e} in MongoDB cache, falling back to direct API`);const a=`/api/payload/wiki-pages?where[parent][equals]=${e}&where[status][equals]=published&sort=sort`;console.log(`[wikiNavStore] Falling back to direct API: ${a}`);const l=await $fetch(a);if(!l||!l.docs)return[];const r=l.docs.map((e=>({id:e.id,title:e.title,slug:e.slug,icon:e.icon,isCategory:!1,hasChildren:!1})));return n(r)}catch(i){return console.error(`[wikiNavStore] Error fetching children for page ${e}:`,i),[]}try{const e="/api/wiki-nav";console.log(`[wikiNavStore] Fetching from MongoDB cache API: ${e}`);const i=await $fetch(e);if(i&&i.length>0)return console.log(`[wikiNavStore] Successfully fetched ${i.length} items from MongoDB cache`),n(i);console.warn("[wikiNavStore] MongoDB cache returned empty navigation data")}catch(t){console.error("[wikiNavStore] Failed to fetch from MongoDB cache:",t)}try{const e="/api/navigation?section=wiki";console.log(`[wikiNavStore] Falling back to navigation API: ${e}`);const i=(await $fetch(e)).map((e=>({id:e.id,title:e.name,isCategory:!0,children:e.pages.map((e=>({id:e.id,title:e.title,slug:e.slug,icon:e.icon,hasChildren:!!e.children?.length,children:e.children||[]}))),hasChildren:e.pages.length>0})));return n(i)}catch(a){return console.error("[wikiNavStore] Navigation API also failed:",a),[]}},s=(e,i)=>{for(const t of e){if(t.id===i)return t;if(t.children&&t.children.length>0){const e=s(t.children,i);if(e)return e}}return null};return{processedNavigationItems:e,pending:t,error:a,isInitialized:l,ensureInitialized:async()=>{if(!l.value&&!t.value){console.log("[wikiNavStore] Initializing navigation store..."),t.value=!0,a.value=null;try{e.value=await r(null),l.value=!0,console.log("[wikiNavStore] Navigation loaded successfully")}catch(i){console.error("Failed to fetch wiki navigation:",i),a.value=i,e.value=[]}finally{t.value=!1}}},toggleExpand:async i=>{const t=s(e.value,i);if(t){if(t.expanded=!t.expanded,!t.isCategory&&t.expanded&&t.hasChildren&&0===t.children.length&&!t.loadingChildren){t.loadingChildren=!0;try{t.children=await r(t.id)}catch(a){console.error(`[wikiNavStore] Failed to fetch children for page ${t.title}:`,a),t.expanded=!1}finally{t.loadingChildren=!1}}}else console.warn(`[wikiNavStore] Item not found for toggleExpand: ${i}`)}}})),E={class:"wiki-navigation bg-light-grey text-gray-800 p-4 rounded-md h-full"},F={class:"text-lg font-semibold"},z={key:1,class:"space-y-1"},B={key:0,class:"category-item group"},L=["onClick","aria-expanded","aria-controls"],P={class:"font-semibold text-md align-middle uppercase text-brand-primary"},M=["aria-label"],j=["id"],T={class:"flex items-center justify-between group"},A={key:1,class:"mr-2 inline-block h-5 w-5 align-middle"},O={class:"align-middle text-sm [font-variant-ligatures:stylistic] [font-feature-settings:'ss01']"},W=["onClick","aria-expanded","aria-label"],q={key:0,class:"text-xs"},G={key:0,class:"ml-6 mt-1 pl-3 border-l border-primary-200 space-y-1"},H={key:1,class:"mr-2 inline-block h-4 w-4 align-middle"},Q={class:"align-middle [font-variant-ligatures:stylistic] [font-feature-settings:'ss01']"},U={key:1,class:"ml-6 mt-1 pl-3 text-xs text-gray-500"},J={key:1,class:"ml-4 mt-1 pl-3 text-xs text-gray-500"},K={key:1,class:"page-item"},R={class:"flex items-center justify-between group"},V={key:1,class:"mr-2 inline-block h-5 w-5 align-middle"},X={class:"align-middle text-sm [font-variant-ligatures:stylistic] [font-feature-settings:'ss01']"},Y=["onClick","aria-expanded","aria-label"],Z={key:0,class:"text-xs"},ee={key:0,class:"ml-6 mt-1 pl-3 border-l border-primary-200 space-y-1"},ie={key:1,class:"mr-2 inline-block h-4 w-4 align-middle"},te={class:"align-middle [font-variant-ligatures:stylistic] [font-feature-settings:'ss01']"},ae={key:1,class:"ml-6 mt-1 pl-3 text-xs text-gray-500"},le={key:2},ne={key:3,class:"text-gray-600"},re={key:4,class:"text-red-500"},se=y(t({__name:"WikiNavigation",props:{navTitle:{type:String,default:"Wiki Menu"},currentParentId:{type:String,default:null}},setup(e){const i={FileText:b,BookOpen:_,Folder:S,Link:I,Info:N,Question:$,Gear:C,House:w,Default:b},t=e=>e&&i[e]||i.Default,y=D();return a((()=>{y.ensureInitialized()})),(i,a)=>{const x=f;return n(),l("div",E,[e.navTitle?(n(),r(x,{key:0,to:"/wiki",prefetch:"",class:"block text-brand-900 hover:bg-purple-light hover:text-primary-700 p-2 rounded-md transition-colors duration-150 -ml-2 -mr-2 mb-1"},{default:o((()=>[d("h3",F,c(e.navTitle),1)])),_:1})):s("",!0),p(y).processedNavigationItems&&p(y).processedNavigationItems.length>0?(n(),l("ul",z,[(n(!0),l(g,null,u(p(y).processedNavigationItems,(e=>(n(),l("li",{key:e.id},[e.isCategory?(n(),l("div",B,[d("div",{onClick:()=>p(y).toggleExpand(e.id),class:"flex items-center justify-between cursor-pointer text-brand-primary hover:bg-purple-light hover:text-primary-700 p-2 rounded-md transition-colors duration-150",role:"button","aria-expanded":e.expanded?"true":"false","aria-controls":`category-children-${e.id}`},[d("h4",P,c(e.title),1),e.children&&e.children.length>0?(n(),l("button",{key:0,class:"p-1 ml-2 rounded-md text-brand-primary hover:text-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":e.expanded?`Collapse ${e.title}`:`Expand ${e.title}`},[d("span",null,c(e.expanded?"-":"+"),1)],8,M)):s("",!0)],8,L),e.expanded&&e.children&&e.children.length>0?(n(),l("ul",{key:0,id:`category-children-${e.id}`,class:"ml-4 mt-1 pl-3 border-l border-primary-200 space-y-1"},[(n(!0),l(g,null,u(e.children,(e=>(n(),l("li",{key:e.id,class:"page-item"},[d("div",T,[h(x,{to:`/wiki/${e.slug}`,prefetch:"",class:"flex-grow text-brand-900 hover:bg-purple-light hover:text-primary-700 p-2 rounded-md transition-colors duration-150","active-class":"bg-purple-light text-primary-700 font-semibold"},{default:o((()=>[e.icon?(n(),r(m(t(e.icon)),{key:0,class:"mr-2 inline-block h-5 w-5 align-middle","aria-hidden":"true"})):(n(),l("span",A)),d("span",O,c(e.title),1)])),_:2},1032,["to"]),e.hasChildren?(n(),l("button",{key:0,onClick:()=>p(y).toggleExpand(e.id),class:"p-1 ml-2 rounded-md text-brand-900 hover:bg-purple-light hover:text-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500","aria-expanded":e.expanded?"true":"false","aria-label":e.expanded?`Collapse ${e.title}`:`Expand ${e.title}`},[e.loadingChildren?(n(),l("span",q,"...")):s("",!0),d("span",null,c(e.expanded?"-":"+"),1)],8,W)):s("",!0)]),e.expanded&&e.children&&e.children.length>0?(n(),l("ul",G,[(n(!0),l(g,null,u(e.children,(e=>(n(),l("li",{key:e.id,class:"sub-page-item"},[h(x,{to:`/wiki/${e.slug}`,prefetch:"",class:"flex items-center text-brand-900 hover:bg-purple-light hover:text-primary-700 p-2 block rounded-md transition-colors duration-150 text-sm","active-class":"bg-purple-light text-primary-700 font-semibold"},{default:o((()=>[e.icon?(n(),r(m(t(e.icon)),{key:0,class:"mr-2 inline-block h-4 w-4 align-middle","aria-hidden":"true"})):(n(),l("span",H)),d("span",Q,c(e.title),1)])),_:2},1032,["to"])])))),128))])):s("",!0),e.expanded&&e.children&&0===e.children.length&&!e.loadingChildren&&e.hasChildren?(n(),l("p",U," No sub-pages. ")):s("",!0)])))),128))],8,j)):s("",!0),!e.expanded||e.children&&0!==e.children.length?s("",!0):(n(),l("p",J," No pages in this category. "))])):(n(),l("div",K,[d("div",R,[h(x,{to:`/wiki/${e.slug}`,prefetch:"",class:"flex-grow text-brand-900 hover:bg-purple-light hover:text-primary-700 p-2 rounded-md transition-colors duration-150","active-class":"bg-purple-light text-primary-700 font-semibold"},{default:o((()=>[e.icon?(n(),r(m(t(e.icon)),{key:0,class:"mr-2 inline-block h-5 w-5 align-middle","aria-hidden":"true"})):(n(),l("span",V)),d("span",X,c(e.title),1)])),_:2},1032,["to"]),e.hasChildren?(n(),l("button",{key:0,onClick:()=>p(y).toggleExpand(e.id),class:"p-1 ml-2 rounded-md text-brand-900 hover:bg-purple-light hover:text-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500","aria-expanded":e.expanded?"true":"false","aria-label":e.expanded?`Collapse ${e.title}`:`Expand ${e.title}`},[e.loadingChildren?(n(),l("span",Z,"...")):s("",!0),d("span",null,c(e.expanded?"-":"+"),1)],8,Y)):s("",!0)]),e.expanded&&e.children&&e.children.length>0?(n(),l("ul",ee,[(n(!0),l(g,null,u(e.children,(e=>(n(),l("li",{key:e.id,class:"sub-page-item"},[h(x,{to:`/wiki/${e.slug}`,prefetch:"",class:"flex items-center text-brand-900 hover:bg-purple-light hover:text-primary-700 p-2 block rounded-md transition-colors duration-150 text-sm","active-class":"bg-purple-light text-primary-700 font-semibold"},{default:o((()=>[e.icon?(n(),r(m(t(e.icon)),{key:0,class:"mr-2 inline-block h-4 w-4 align-middle","aria-hidden":"true"})):(n(),l("span",ie)),d("span",te,c(e.title),1)])),_:2},1032,["to"])])))),128))])):s("",!0),e.expanded&&e.children&&0===e.children.length&&!e.loadingChildren&&e.hasChildren?(n(),l("p",ae," No sub-pages. ")):s("",!0)]))])))),128))])):p(y).pending||p(y).processedNavigationItems&&0!==p(y).processedNavigationItems.length?s("",!0):(n(),l("p",le," No categories or pages found for the wiki. ")),p(y).pending&&!p(y).isInitialized?(n(),l("p",ne,"Loading navigation...")):s("",!0),p(y).error?(n(),l("p",re,"Error loading navigation: "+c(p(y).error.message),1)):s("",!0)])}}}),[["__scopeId","data-v-fe827467"]]),oe={class:"flex flex-col items-start lg:flex-row relative"},de={class:"flex-1 p-4 lg:p-8"},ce={class:"relative"},pe=y(t({__name:"WikiLayout",props:{backgroundImageUrl:{type:String,default:void 0},backgroundOverlay:{type:String,default:"none"},navParentId:{type:String,default:null},navTitle:{type:String,default:"In this section"},isLeftSidebarOpen:{type:Boolean,default:!1}},emits:["closeLeftSidebar"],setup:(e,{emit:i})=>(i,t)=>{const a=se,r=k;return n(),l("div",oe,[d("aside",{class:x(["w-full fixed top-0 left-0 z-[11] pt-[5.5rem] overflow-scroll h-screen bg-light-grey lg:bg-none lg:h-auto lg:min-h-screen lg:translate-x-0 lg:w-[21.6rem] lg:pt-0 lg:pr-0 lg:sticky lg:top-[5.5rem] transition-all duration-700",{"translate-x-[-100%]":!e.isLeftSidebarOpen,"translate-x-[0]":e.isLeftSidebarOpen}])},[h(a,{"current-parent-id":e.navParentId,"nav-title":e.navTitle},null,8,["current-parent-id","nav-title"]),d("button",{onClick:t[0]||(t[0]=e=>i.$emit("closeLeftSidebar")),class:"absolute top-[6.5rem] right-3 z-[12] lg:hidden h-[30px] w-[30px]","aria-title":"Close wiki nav"},[h(r,{name:"ph:x",size:"24"})])],2),d("section",de,[d("div",ce,[v(i.$slots,"default",{},void 0,!0)])])])}}),[["__scopeId","data-v-7e2c241f"]]);export{pe as W};
