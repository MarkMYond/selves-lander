import{H as e,s as t,f as r,v as a,c as l,o as i,j as n,r as s,w as o,a as d,t as c,k as g,I as p,J as u,b as h,e as f,_ as y,n as m,F as v,A as x}from"./BfbKYXm_.js";const b=e("registryNav",(()=>{const e=t([]),r=t(!1),a=t(null),l=t(!1),i="/registry-navigation.json",n=e=>e.map((e=>({...e,slug:e.slug,icon:e.icon,expanded:!!e.isCategory,loadingChildren:!1,children:e.children?n(e.children):[]}))),s=async e=>{if(e)try{const t=`/api/registry-nav?parentId=${e}`;console.log(`[registryNavStore] Fetching children for page ID ${e} from navigation cache: ${t}`);const r=await $fetch(t);if(r&&r.length>0)return console.log(`[registryNavStore] Successfully fetched ${r.length} child items from MongoDB cache`),n(r);console.warn(`[registryNavStore] No children found for parent ID ${e} in MongoDB cache, falling back to direct API`);const a=`/api/payload/registry-pages?where[parent][equals]=${e}&where[status][equals]=published&sort=sort`;console.log(`[registryNavStore] Falling back to direct API: ${a}`);const l=await $fetch(a);if(!l||!l.docs)return[];const i=l.docs.map((e=>({id:e.id,title:e.title,slug:e.slug,icon:e.icon,hasChildren:!1})));return n(i)}catch(t){return console.error(`[registryNavStore] Error fetching children for page ${e}:`,t),[]}try{const e="/api/registry-nav";console.log(`[registryNavStore] Fetching from MongoDB cache API: ${e}`);const t=await $fetch(e);if(t&&t.length>0)return console.log(`[registryNavStore] Successfully fetched ${t.length} items from MongoDB cache`),n(t);console.warn("[registryNavStore] MongoDB cache returned empty navigation data")}catch(r){console.error("[registryNavStore] Failed to fetch from MongoDB cache:",r)}try{console.log(`[registryNavStore] Falling back to static file: ${i}`);const e=await $fetch(i);return n(e)}catch(a){return console.error("[registryNavStore] Static navigation file also failed:",a),[]}},o=(e,t)=>{for(const r of e){if(r.id===t)return r;if(r.children&&r.children.length>0){const e=o(r.children,t);if(e)return e}}return null};return{processedNavigationItems:e,pending:r,error:a,isInitialized:l,ensureInitialized:async()=>{if(!l.value&&!r.value){console.log("[registryNavStore] Initializing navigation store..."),r.value=!0,a.value=null;try{e.value=await s(null),l.value=!0,console.log("[registryNavStore] Navigation loaded successfully")}catch(t){console.error("Failed to fetch registry navigation:",t),a.value=t,e.value=[]}finally{r.value=!1}}},toggleExpand:async t=>{const r=o(e.value,t);if(r){if(r.expanded=!r.expanded,r.expanded&&r.hasChildren&&0===r.children.length&&!r.loadingChildren){r.loadingChildren=!0;try{r.children=await s(r.id)}catch(a){console.error(`[registryNavStore] Failed to fetch children for ${r.title}:`,a)}finally{r.loadingChildren=!1}}}else console.warn(`[registryNavStore] Item not found for toggleExpand: ${t}`)}}})),k={class:"registry-navigation bg-light-grey text-gray-800 p-4 rounded-md h-full"},N={class:"text-lg font-semibold"},$={key:1,class:"space-y-1"},S={key:0,class:"category-item group"},C=["onClick","aria-expanded","aria-controls"],I={class:"font-semibold text-md align-middle uppercase text-brandNeutral-04"},w=["aria-label"],_=["id"],E={class:"flex items-center justify-between group"},z={class:"align-middle text-sm [font-variant-ligatures:stylistic] [font-feature-settings:'ss01']"},D=["onClick","aria-expanded","aria-label"],F={key:0,class:"text-xs"},B={key:0,class:"ml-6 mt-1 pl-3 border-l border-primary-200 space-y-1"},L={class:"align-middle [font-variant-ligatures:stylistic] [font-feature-settings:'ss01']"},M={key:1,class:"ml-6 mt-1 pl-3 text-xs text-gray-500"},j={key:1,class:"ml-4 mt-1 pl-3 text-xs text-gray-500"},P={key:1,class:"page-item"},T={class:"flex items-center justify-between group"},A={class:"align-middle text-sm [font-variant-ligatures:stylistic] [font-feature-settings:'ss01']"},O=["onClick","aria-expanded","aria-label"],R={key:0,class:"text-xs"},q={key:0,class:"ml-6 mt-1 pl-3 border-l border-primary-200 space-y-1"},H={class:"align-middle [font-variant-ligatures:stylistic] [font-feature-settings:'ss01']"},J={key:1,class:"ml-6 mt-1 pl-3 text-xs text-gray-500"},U={key:2},G={key:3,class:"text-gray-600"},K={key:4,class:"text-red-500"},Q=y(r({__name:"RegistryNavigation",props:{navTitle:{type:String,default:"Registry Menu"},currentParentId:{type:String,default:null}},setup(e){const t=b();return a((()=>{t.ensureInitialized()})),(r,a)=>{const y=f;return i(),l("div",k,[e.navTitle?(i(),n(y,{key:0,to:"/registry",class:"block text-brandNeutral-04 hover:bg-purple-light hover:text-primary-700 p-2 rounded-md transition-colors duration-150 -ml-2 -mr-2 mb-1"},{default:o((()=>[d("h3",N,c(e.navTitle),1)])),_:1})):s("",!0),g(t).processedNavigationItems&&g(t).processedNavigationItems.length>0?(i(),l("ul",$,[(i(!0),l(p,null,u(g(t).processedNavigationItems,(e=>(i(),l("li",{key:e.id},[e.isCategory?(i(),l("div",S,[d("div",{onClick:()=>g(t).toggleExpand(e.id),class:"flex items-center justify-between cursor-pointer text-brandNeutral-04 hover:bg-purple-light hover:text-primary-700 p-2 rounded-md transition-colors duration-150",role:"button","aria-expanded":e.expanded?"true":"false","aria-controls":`category-children-${e.id}`},[d("h4",I,c(e.title),1),d("button",{vif:"item.children && item.children.length > 0",class:"p-1 ml-2 rounded-md text-brandNeutral-04 hover:text-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":e.expanded?`Collapse ${e.title}`:`Expand ${e.title}`},[d("span",null,c(e.expanded?"-":"+"),1)],8,w)],8,C),e.expanded&&e.children&&e.children.length>0?(i(),l("ul",{key:0,id:`category-children-${e.id}`,class:"ml-4 mt-1 pl-3 border-l border-primary-200 space-y-1"},[(i(!0),l(p,null,u(e.children,(e=>(i(),l("li",{key:e.id,class:"page-item"},[d("div",E,[h(y,{to:`/registry/${e.slug}`,prefetch:"",class:"flex-grow text-brandNeutral-04 hover:bg-purple-light hover:text-primary-700 p-2 rounded-md transition-colors duration-150","active-class":"bg-purple-light text-primary-700 font-semibold"},{default:o((()=>[d("span",z,c(e.title),1)])),_:2},1032,["to"]),e.hasChildren?(i(),l("button",{key:0,onClick:()=>g(t).toggleExpand(e.id),class:"p-1 ml-2 rounded-md text-brandNeutral-04 hover:bg-purple-light hover:text-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500","aria-expanded":e.expanded?"true":"false","aria-label":e.expanded?`Collapse ${e.title}`:`Expand ${e.title}`},[e.loadingChildren?(i(),l("span",F,"...")):s("",!0),d("span",null,c(e.expanded?"-":"+"),1)],8,D)):s("",!0)]),e.expanded&&e.children&&e.children.length>0?(i(),l("ul",B,[(i(!0),l(p,null,u(e.children,(e=>(i(),l("li",{key:e.id,class:"sub-page-item"},[h(y,{to:`/registry/${e.slug}`,prefetch:"",class:"flex items-center text-brandNeutral-04 hover:bg-purple-light hover:text-primary-700 p-2 block rounded-md transition-colors duration-150 text-sm","active-class":"bg-purple-light text-primary-700 font-semibold"},{default:o((()=>[d("span",L,c(e.title),1)])),_:2},1032,["to"])])))),128))])):s("",!0),e.expanded&&e.children&&0===e.children.length&&!e.loadingChildren&&e.hasChildren?(i(),l("p",M," No sub-pages. ")):s("",!0)])))),128))],8,_)):s("",!0),!e.expanded||e.children&&0!==e.children.length?s("",!0):(i(),l("p",j," No pages in this category. "))])):(i(),l("div",P,[d("div",T,[h(y,{to:`/registry/${e.slug}`,prefetch:"",class:"flex-grow text-brandNeutral-04 hover:bg-purple-light hover:text-primary-700 p-2 rounded-md transition-colors duration-150","active-class":"bg-purple-light text-primary-700 font-semibold"},{default:o((()=>[d("span",A,c(e.title),1)])),_:2},1032,["to"]),e.hasChildren?(i(),l("button",{key:0,onClick:()=>g(t).toggleExpand(e.id),class:"p-1 ml-2 rounded-md text-brandNeutral-04 hover:bg-purple-light hover:text-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500","aria-expanded":e.expanded?"true":"false","aria-label":e.expanded?`Collapse ${e.title}`:`Expand ${e.title}`},[e.loadingChildren?(i(),l("span",R,"...")):s("",!0),d("span",null,c(e.expanded?"-":"+"),1)],8,O)):s("",!0)]),e.expanded&&e.children&&e.children.length>0?(i(),l("ul",q,[(i(!0),l(p,null,u(e.children,(e=>(i(),l("li",{key:e.id,class:"sub-page-item"},[h(y,{to:`/registry/${e.slug}`,prefetch:"",class:"flex items-center text-brandNeutral-04 hover:bg-purple-light hover:text-primary-700 p-2 block rounded-md transition-colors duration-150 text-sm","active-class":"bg-purple-light text-primary-700 font-semibold"},{default:o((()=>[d("span",H,c(e.title),1)])),_:2},1032,["to"])])))),128))])):s("",!0),e.expanded&&e.children&&0===e.children.length&&!e.loadingChildren&&e.hasChildren?(i(),l("p",J," No sub-pages. ")):s("",!0)]))])))),128))])):g(t).pending||g(t).processedNavigationItems&&0!==g(t).processedNavigationItems.length?s("",!0):(i(),l("p",U," No categories or pages found for the registry. ")),g(t).pending&&!g(t).isInitialized?(i(),l("p",G," Loading navigation... ")):s("",!0),g(t).error?(i(),l("p",K," Error loading navigation: "+c(g(t).error.message),1)):s("",!0)])}}}),[["__scopeId","data-v-1942744a"]]),V={class:"flex flex-col items-start lg:flex-row relative"},W={class:"flex-1 p-4 lg:p-8"},X={class:"relative"},Y=y(r({__name:"RegistryLayout",props:{backgroundImageUrl:{type:String,default:void 0},backgroundOverlay:{type:String,default:"none"},navParentId:{type:String,default:null},navTitle:{type:String,default:"In this section"},isLeftSidebarOpen:{type:Boolean,default:!1}},emits:["closeLeftSidebar"],setup:(e,{emit:t})=>(t,r)=>{const a=Q,n=x;return i(),l("div",V,[d("aside",{class:m(["w-full fixed top-0 left-0 z-[11] pt-[5.5rem] overflow-scroll h-screen bg-light-grey lg:bg-transparent lg:p-6 lg:h-[calc(100vh-5.5rem)] lg:overflow-y-auto lg:translate-x-0 lg:w-[21.6rem] lg:sticky lg:top-[5.5rem] transition-all duration-700",{"translate-x-[-100%]":!e.isLeftSidebarOpen,"translate-x-[0]":e.isLeftSidebarOpen}])},[h(a,{"current-parent-id":e.navParentId,"nav-title":e.navTitle},null,8,["current-parent-id","nav-title"]),d("button",{onClick:r[0]||(r[0]=e=>t.$emit("closeLeftSidebar")),class:"absolute top-[6.5rem] right-3 z-[12] lg:hidden h-[30px] w-[30px]","aria-title":"Close wiki nav"},[h(n,{name:"ph:x",size:"24"})])],2),d("main",W,[d("div",X,[v(t.$slots,"default",{},void 0,!0)])])])}}),[["__scopeId","data-v-83df0a23"]]);export{Y as R};
