import{s as e,v as a,i as r,f as t,u as s,h as l,g as o,j as n,w as i,x as u,z as d,y as c,o as v,c as m,k as g,a as p,b,t as y,e as h,d as x,r as f,A as k,n as w}from"./BfbKYXm_.js";import{_ as $}from"./CgPUxc3W.js";import{s as j}from"./DAViBy51.js";import{_ as R}from"./CGCiTkgm.js";import{R as _}from"./CPfQwTk-.js";import{u as S}from"./CTOCC48s.js";import{u as A}from"./DAcegZ-V.js";import"./D1HCBIMP.js";const I={key:0,class:"py-12 text-center"},P={class:"mt-3 text-gray-500 max-w-md mx-auto mb-6"},E={key:1},L={class:"max-w-3xl mx-auto px-6 pt-8"},D={class:"flex items-center justify-between mb-4"},z={class:"flex items-center gap-2"},B={class:"flex items-center"},C={class:"text-sm text-brand-primary dark:text-primary-300"},N={key:0,class:"mx-1"},U={key:1},T={class:"font-medium text-brand-primary dark:text-primary-300"},W={class:"max-w-3xl mx-auto h-40 md:h-48 relative overflow-visible"},q=["src"],F={class:"text-brandNeutral-04 dark:text-brand-100 tracking-tight text-7xl leading-[86px] max-md:text-6xl max-sm:text-4xl max-sm:leading-10 mt-8 mb-10 border-b border-brand-50 dark:border-primary-700 pb-4"},O={class:"prose prose-slate max-w-none dark:prose-invert"},G={key:0,class:"mt-8 pt-4 border-t border-brand-50 dark:border-primary-700 text-sm text-brand-primary dark:text-primary-300"},H=t({__name:"[slug]",async setup(t){let H,M;const{getMediaUrl:J}=d(),K=u();c();const Q=s().public.payloadApiFullUrl,V=e("registry"),{navData:X}=function(t){const s=e(null),l=e(!0),o=e(null),n=e(!1);a((()=>{n.value=!0}));const i=async e=>{if(e){l.value=!0,o.value=null;try{const a=`/api/navigation?section=${e}`,r=`navigation-${e}-${Date.now()}`,{data:t,error:l}=await A(a,{key:r,headers:{"Cache-Control":"no-cache"},onResponseError(e){if(404!==e.response.status)throw new Error(`API Error: ${e.response.statusText}`)},suspense:!1},"$I4Dx1f3bIj");if(l.value)throw l.value;t.value&&Array.isArray(t.value)?s.value=t.value:s.value=[]}catch(a){console.error(`Navigation fetch error for section ${e}:`,a),o.value=a instanceof Error?a:new Error("Unknown error fetching navigation"),s.value=[]}finally{l.value=!1}}};return r(t,((e,a)=>{e&&e!==a&&i(e)}),{immediate:!0}),{navData:s,loading:l,error:o,refresh:()=>{t.value&&i(t.value)}}}(V),Y=l((()=>{const e=K.params.slug;return Array.isArray(e)?e[e.length-1]:e})),Z=l((()=>`registry-page-${K.fullPath}`)),{data:ee,pending:ae,error:re}=([H,M]=o((()=>A((()=>`/registry-pages?where[slug][equals]=${Y.value}&depth=2&limit=1`),{baseURL:Q,key:Z.value,transform:async e=>Q?e&&e.docs?e:(console.warn(`Registry Slug Page: No docs found in page response for slug ${Y.value} or response is null.`),{docs:[]}):(console.error(`Registry Slug Page: Payload API URL is not configured for slug ${Y.value}.`),{docs:[]}),onRequestError({request:e,options:a,error:r}){console.error(`Registry Slug Page: Error fetching page data for slug ${Y.value} from ${a.baseURL}${e}:`,r)},cache:"no-cache",watch:!1},"$0OJ1FDIF11"))),H=await H,M(),H),te=l((()=>ee.value?.docs?.[0])),se=l((()=>{const e=te.value?.backgroundSettings,a=e?.backgroundImage;return"object"==typeof a&&null!==a&&"url"in a&&a.url?a.url.startsWith("http://")||a.url.startsWith("https://")?a.url:J(a):"string"==typeof a?a.startsWith("http://")||a.startsWith("https://")?a:J(a):void 0})),le=l((()=>te.value?.backgroundSettings?.backgroundOverlay)),oe=l((()=>{const e=le.value;return e&&/^(brandTheme-(01|02|03|04)|brandNeutral-(01|02|03|04)|light-grey)$/.test(e)?`bg-${e}`:"bg-brandNeutral-01"})),ne=l((()=>{const e=le.value,a=e&&/^primary-(25|50|100|200|300|400|500|600|700|800|900|950)$/.test(e);return!!se.value||a})),ie=l((()=>(e=>{if(!e)return null;try{return new Date(e).toLocaleDateString("en-GB",{year:"numeric",month:"short",day:"numeric"})}catch(a){return console.error("Error formatting date:",a),null}})(te.value?.updatedAt)));l((()=>te.value?.pageBuilder?te.value.pageBuilder.filter((e=>"sectionHeaderBlock"===e.blockType&&"string"==typeof e.title&&["h1","h2","h3"].includes(e.level||""))).map((e=>{const a=e.title;return{id:e.anchorId?j(e.anchorId,{lower:!0,strict:!0}):j(a,{lower:!0,strict:!0}),text:a,level:e.level||"h2"}})):[])),S(te.value,"article"),e(!1);const ue=e(!1);return a((()=>{window.innerWidth>=1024&&(ue.value=!0)})),(e,a)=>{const r=h,t=k,s=$;return v(),n(_,{"nav-parent-id":null,"nav-title":"Registry Menu",isLeftSidebarOpen:ue.value,onCloseLeftSidebar:a[3]||(a[3]=e=>ue.value=!1)},{default:i((()=>[g(re)||!te.value?(v(),m("div",I,[a[5]||(a[5]=p("div",{class:"w-24 h-24 mx-auto mb-6 text-4xl"},"🔩",-1)),a[6]||(a[6]=p("h1",{class:"text-3xl font-bold text-gray-700 mb-3"}," Registry Page Not Found ",-1)),p("p",P," The registry page you're looking for doesn't exist or has been moved. (Slug: "+y(Y.value)+") ",1),b(r,{to:"/registry",class:"inline-flex items-center px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90"},{default:i((()=>a[4]||(a[4]=[p("span",{class:"mr-1"},"←",-1),x(" Back to Registry Home ")]))),_:1,__:[4]})])):(v(),m("div",E,[p("div",L,[p("div",D,[p("div",z,[p("div",B,[p("button",{onClick:a[0]||(a[0]=a=>e.$router.back()),class:"p-1 rounded hover:bg-brand-100 dark:hover:bg-slate-700 text-brand-400 hover:text-brand-500 dark:hover:text-brand-300","aria-label":"Go back"},[b(t,{name:"ph:arrow-left",size:"16"})]),p("button",{onClick:a[1]||(a[1]=a=>e.$router.forward()),class:"p-1 rounded hover:bg-brand-100 dark:hover:bg-slate-700 text-brand-400 hover:text-brand-500 dark:hover:text-brand-300","aria-label":"Go forward"},[b(t,{name:"ph:arrow-right",size:"16"})])]),p("div",C,[b(r,{to:"/registry",class:"hover:text-brand-primary/80 dark:hover:text-primary-200"},{default:i((()=>a[7]||(a[7]=[x("Registry")]))),_:1,__:[7]}),te.value.category&&"object"==typeof te.value.category?(v(),m("span",N,"/")):f("",!0),te.value.category&&"object"==typeof te.value.category?(v(),m("span",U,y(te.value.category.name),1)):f("",!0),a[8]||(a[8]=p("span",{class:"mx-1"},"/",-1)),p("span",T,y(te.value.title),1)])]),p("button",{onClick:a[2]||(a[2]=e=>ue.value=!0),class:"p-1 rounded hover:bg-brand-100 text-gray-500 hover:text-gray-600 ml-auto lg:hidden","aria-label":"Toggle table of contents"},[b(t,{name:"ph:list",size:"16"})])])]),ne.value?(v(),m("div",{key:0,class:w(["mt-5 mb-16 mx-5 rounded-lg relative overflow-visible",oe.value])},[p("div",W,[se.value?(v(),m("img",{key:0,src:se.value,alt:"Page Icon",class:"absolute left-8 -bottom-10 h-52 w-52 md:h-60 md:w-60 object-contain z-10"},null,8,q)):(v(),n(t,{key:1,name:"ph:squares-four",class:"absolute left-8 -bottom-10 text-white z-10 h-52 w-52 md:h-60 md:w-60"}))])],2)):f("",!0),p("div",{class:w(["max-w-3xl mx-auto px-6 pb-8",{"pt-8":!ne.value}])},[p("article",null,[p("h1",F,y(te.value.title),1),p("div",O,[b(R,{blocks:te.value.pageBuilder||[]},null,8,["blocks"])]),ie.value?(v(),m("div",G," Last updated: "+y(ie.value),1)):f("",!0)]),g(X)&&g(X).length>0&&te.value&&Y.value?(v(),n(s,{key:0,"nav-data":g(X),"current-page-slug":Y.value,section:"registry"},null,8,["nav-data","current-page-slug"])):f("",!0)],2)]))])),_:1},8,["isLeftSidebarOpen"])}}});export{H as default};
